"use strict";class FbEventsApi{constructor(pixelDefault,events=[],pixelParamName="fb"){this.pixel=this.getPixel(pixelDefault,pixelParamName),this.events=Array.isArray(events)?events:[events],this.eventTime=Math.floor(Date.now()/1e3)-60,this.id=this.getUniqueEventId(),this.external_id=null,this.order_id=null,eval("!function(f,b,e,v,n,t,s) {if(f.fbq)return;n=f.fbq=function(){n.callMethod? n.callMethod.apply(n,arguments):n.queue.push(arguments)}; if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0'; n.queue=[];t=b.createElement(e);t.async=!0; t.src=v;s=b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t,s)}(window, document,'script', 'https://connect.facebook.net/en_US/fbevents.js');")}init(){if(null!==this.pixel){let e=this.getUserData(!0);fbq("init",this.pixel),this.events.forEach(t=>{this.track(t,e)})}return this}track(e,t){return null!==this.pixel&&("function"==typeof e?e():void 0!==t?fbq("track",e,t):fbq("track",e)),this}encrypt(e){return CryptoJS.SHA256(e).toString()}setLocation(){return new Promise((e,t)=>{void 0===FbEventsApi.getCookie("fbuser_location")?fetch("https://myip.wtf/json").then(e=>e.json()).then(t=>{FbEventsApi.setCookie("fbuser_location",JSON.stringify(t),1),e(JSON.stringify(t))}).catch(e=>{t(e)}):e(FbEventsApi.getCookie("fbuser_location"))})}setExternalId(e){return this.external_id=e,this}setOrderId(e){return this.order_id=e,this}static setCookie(e,t,i){let n="";if(i){let r=new Date;r.setTime(r.getTime()+864e5*i),n="; expires="+r.toUTCString()}return document.cookie=e+"="+(t||"")+n+"; path=/",this}static getCookie(e){let t=e+"=",i=decodeURIComponent(document.cookie).split(";");for(let n=0;n<i.length;n++){let r=i[n];for(;" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}}static deleteCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}getUser(){if(void 0!==FbEventsApi.getCookie("fbuser_data"))return JSON.parse(FbEventsApi.getCookie("fbuser_data"));{let e=this.getGender(),t=this.getName(),i=this.getEmail(),n=this.getPhone(),r={};return e&&Object.assign(r,{gender:e}),i&&Object.assign(r,{email:i}),n&&Object.assign(r,{phone:n}),t&&t.fn&&Object.assign(r,{first_name:t.fn}),t&&t.ln&&Object.assign(r,{last_name:t.ln}),FbEventsApi.setCookie("fbuser_data",JSON.stringify(r),365),r}}getPixel(e,t){let i=this.getParams(t);return null===i?e:i}getUserData(e=!1){let t={},i=this.getFbp(),n=this.getFbc(),r=this.getSourceUrl(),s=JSON.parse(FbEventsApi.getCookie("fbuser_location")),o=this.getUser();return this.external_id&&(t.external_id=this.id),this.order_id&&(t.order_id=this.id),o.first_name&&(t.fn=e?this.encrypt(o.first_name.toLowerCase()):o.first_name),o.last_name&&(t.ln=e?this.encrypt(o.last_name.toLowerCase()):o.last_name),o.email&&(t.em=e?this.encrypt(o.email):o.email),o.gender&&(t.ge=e?this.encrypt(o.gender):o.gender),o.phone&&(t.ph=e?this.encrypt(o.phone):o.phone),s.YourFuckingIPAddress&&(t.client_ip_address=e?this.encrypt(s.YourFuckingIPAddress):s.YourFuckingIPAddress),s.YourFuckingCity&&(t.ct=e?this.encrypt(s.YourFuckingCity.toLowerCase()):s.YourFuckingCity,t.city=e?this.encrypt(s.YourFuckingCity.toLowerCase()):s.YourFuckingCity),s.YourFuckingLocation&&(t.st=e?this.encrypt(s.YourFuckingLocation.toLowerCase().split(", ")[1]):s.YourFuckingLocation.split(", ")[1]),s.YourFuckingCountryCode&&(t.country=e?this.encrypt(s.YourFuckingCountryCode.toLowerCase()):s.YourFuckingCountryCode),r&&(t.event_source_url=r),void 0!==i&&(t.fbp=i),void 0!==n&&(t.fbc=n),t}getEventData(e){return{eventID:this.id,eventName:e,eventTime:this.eventTime}}getParams(e){let t=new URLSearchParams(window.location.search);return t.get(e)}getFbc(){if(void 0===FbEventsApi.getCookie("_fbc")){let e=this.getParams("fbclid");e&&setCookie("_fbc","fb.1."+new Date().getTime()+"."+e,7)}return FbEventsApi.getCookie("_fbc")}getFbp(){if(void 0===FbEventsApi.getCookie("_fbp")){let e=this.getParams("fbp");e&&setCookie("_fbp",e,7)}return FbEventsApi.getCookie("_fbp")}getSourceUrl(){return`${window.location.protocol}//${window.location.host}${window.location.pathname}`}getUniqueEventId(){let e=Math.random().toString(36).substring(2,15);return"".concat(e,"-").concat(this.eventTime)}getEmail(){return FbEventsApi.getCookie("lead::email")}getGender(){let e=["f","m"],t=e.length;return e[parseInt(Math.random()*t)]}getPhone(){return FbEventsApi.getCookie("lead::phone")}getName(){let e=FbEventsApi.getCookie("lead::name"),t=e?e.split(" "):[],i=t&&t[0]?t[0]:null,n=t&&t[1]&&t.slice(1).join(" ")||null;return{fn:i,ln:n}}}