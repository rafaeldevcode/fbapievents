"use strict";class FbEventsApi{constructor(pixelDefault,events=[]){this.pixel=this.getPixel(pixelDefault),this.events=Array.isArray(events)?events:[events],this.eventTime=Math.floor(Date.now()/1e3)-60,this.id=this.getUniqueEventId(),this.external_id=null,this.order_id=null,eval("!function(f,b,e,v,n,t,s) {if(f.fbq)return;n=f.fbq=function(){n.callMethod? n.callMethod.apply(n,arguments):n.queue.push(arguments)}; if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0'; n.queue=[];t=b.createElement(e);t.async=!0; t.src=v;s=b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t,s)}(window, document,'script', 'https://connect.facebook.net/en_US/fbevents.js');")}init(){if(null!==this.pixel){const e=this.getUserData(!0);fbq("init",this.pixel),this.events.forEach((t=>{this.track(t,e)}))}return this}track(e,t=void 0){return null!==this.pixel&&("function"==typeof e?e():void 0!==t?fbq("track",e,t):fbq("track",e)),this}encrypt(e){return CryptoJS.SHA256(e).toString()}setLocation(){return new Promise(((e,t)=>{void 0===FbEventsApi.getCookie("fbuser_location")?fetch("https://myip.wtf/json").then((e=>e.json())).then((t=>{FbEventsApi.setCookie("fbuser_location",JSON.stringify(t),1),e(JSON.stringify(t))})).catch((e=>{t(e)})):e(FbEventsApi.getCookie("fbuser_location"))}))}setExternalId(e){return this.external_id=e,this}setOrderId(e){return this.order_id=e,this}static setCookie(e,t,n){let i="";if(n){let e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),i="; expires="+e.toUTCString()}return document.cookie=e+"="+(t||"")+i+"; path=/",this}static getCookie(e){let t=e+"=",n=decodeURIComponent(document.cookie).split(";");for(let e=0;e<n.length;e++){let i=n[e];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}}static deleteCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}getUser(){if(void 0===FbEventsApi.getCookie("fbuser_data")){let e=this.getGender(),t=this.getName(),n=this.getEmail(),i=this.getPhone(),s={};return e&&Object.assign(s,{gender:e}),n&&Object.assign(s,{email:n}),i&&Object.assign(s,{phone:i}),t&&t.fn&&Object.assign(s,{first_name:t.fn}),t&&t.ln&&Object.assign(s,{last_name:t.ln}),FbEventsApi.setCookie("fbuser_data",JSON.stringify(s),365),s}return JSON.parse(FbEventsApi.getCookie("fbuser_data"))}getPixel(e){const t=this.getParams("fb");return null===t?e:t}getUserData(e=!1){let t={},n=this.getFbp(),i=this.getFbc(),s=this.getSourceUrl(),o=JSON.parse(FbEventsApi.getCookie("fbuser_location")),r=this.getUser();return this.external_id&&(t.external_id=this.id),this.order_id&&(t.order_id=this.id),r.first_name&&(t.fn=e?this.encrypt(r.first_name.toLowerCase()):r.first_name),r.last_name&&(t.ln=e?this.encrypt(r.last_name.toLowerCase()):r.last_name),r.email&&(t.em=e?this.encrypt(r.email):r.email),r.gender&&(t.ge=e?this.encrypt(r.gender):r.gender),r.phone&&(t.ph=e?this.encrypt(r.phone):r.phone),o.YourFuckingIPAddress&&(t.client_ip_address=e?this.encrypt(o.YourFuckingIPAddress):o.YourFuckingIPAddress),o.YourFuckingCity&&(t.ct=e?this.encrypt(o.YourFuckingCity.toLowerCase()):o.YourFuckingCity,t.city=e?this.encrypt(o.YourFuckingCity.toLowerCase()):o.YourFuckingCity),o.YourFuckingLocation&&(t.st=e?this.encrypt(o.YourFuckingLocation.toLowerCase().split(", ")[1]):o.YourFuckingLocation.split(", ")[1]),o.YourFuckingCountryCode&&(t.country=e?this.encrypt(o.YourFuckingCountryCode.toLowerCase()):o.YourFuckingCountryCode),s&&(t.event_source_url=s),void 0!==n&&(t.fbp=n),void 0!==i&&(t.fbc=i),t}getEventData(e){return{eventID:this.id,eventName:e,eventTime:this.eventTime}}getParams(e){return new URLSearchParams(window.location.search).get(e)}getFbc(){if(void 0===FbEventsApi.getCookie("_fbc")){const e=this.getParams("fbclid");e&&setCookie("_fbc","fb.1."+(new Date).getTime()+"."+e,7)}return FbEventsApi.getCookie("_fbc")}getFbp(){if(void 0===FbEventsApi.getCookie("_fbp")){const e=this.getParams("fbp");e&&setCookie("_fbp",e,7)}return FbEventsApi.getCookie("_fbp")}getSourceUrl(){return`${window.location.protocol}//${window.location.host}${window.location.pathname}`}getUniqueEventId(){let e=Math.random().toString(36).substring(2,15);return"".concat(e,"-").concat(this.eventTime)}getEmail(){return FbEventsApi.getCookie("lead::email")}getGender(){const e=["f","m"],t=e.length;return e[parseInt(Math.random()*t)]}getPhone(){return FbEventsApi.getCookie("lead::phone")}getName(){const e=FbEventsApi.getCookie("lead::name"),t=e?e.split(" "):[];return{fn:t&&t[0]?t[0]:null,ln:t&&t[1]&&t.slice(1).join(" ")||null}}}